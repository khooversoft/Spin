@rendermode InteractiveServer
@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using Toolbox.Tools;

@if (_flow.State == 1)
{
    @switch (_showIndex)
    {
        case false:
            <LeftOverviewIndex ShowIndex="OnShowIndex" DbName="@DbName" />
            break;

        case true:
            <LeftContextIndex ShowIndex="OnShowIndex" DbName="@DbName" />
            break;
    }
}

@code {
    [Parameter] public string? DbName { get; init; }
    [Inject] public ProtectedSessionStorage _store { get; init; } = null!;

    private bool _showIndex { get; set; }
    private SequentialState _flow = new SequentialState();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _flow.MoveState(1);
            await GetShowIndex();
            StateHasChanged();
        }

        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task OnShowIndex()
    {
        _showIndex = !_showIndex;
        await _store.SetAsync(nameof(_showIndex), _showIndex);
    }

    private async Task GetShowIndex()
    {
        var result = await _store.GetAsync<bool>(nameof(_showIndex));
        _showIndex = result.Success ? result.Value : false;
    }
}
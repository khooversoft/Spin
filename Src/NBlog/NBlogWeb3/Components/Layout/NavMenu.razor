@using Microsoft.AspNetCore.Components.Server.ProtectedBrowserStorage
@using NBlog.sdk
@using NBlogWeb3.Components.Controls
@using Toolbox.Tools
@rendermode InteractiveServer

<div class="top-row ps-3 navbar navbar-dark">
    <div class="container-fluid">
        <div>
            <a href="/summary/article/home">
                <img src="/Images/khicon.svg" class="img-fluid" style="max-width: 64px;" aria-label="KH" />
            </a>
            <span class="navbar-brand">Kelvin Hoover</span>
        </div>
    </div>
</div>

<input type="checkbox" title="Navigation menu" class="navbar-toggler" />

<div class="nav-scrollable" onclick="document.querySelector('.navbar-toggler').click()">
    @if (_flow.State == 1)
    {
        @switch (_showIndex)
        {
            case false:
                <LeftMenuContent ShowIndex="OnShowIndex" Configuration="@Configuration" />
                break;
@* 
            case true:
                <LeftContextIndex ShowIndex="OnShowIndex" DbName="@DbName" />
                break; *@
        }
    }
</div>

@code {
    [Parameter] public NBlogConfiguration? Configuration { get; init; }
    [Inject] public ProtectedSessionStorage _store { get; init; } = null!;

    private bool _showIndex { get; set; }
    private SequentialState _flow = new SequentialState();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            _flow.MoveState(1);
            await GetShowIndex();
            StateHasChanged();
        }

        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task OnShowIndex()
    {
        _showIndex = !_showIndex;
        await _store.SetAsync(nameof(_showIndex), _showIndex);
    }

    private async Task GetShowIndex()
    {
        var result = await _store.GetAsync<bool>(nameof(_showIndex));
        _showIndex = result.Success ? result.Value : false;
    }
}
@using TicketShareWeb.Components.Pages.Profile.Models

@implements IDialogContentComponent<PanelParameters<ContactModel>>

<FluentDialogBody>

    <DialogControls OnSet="OnSetButton" OnClose="OnCloseButton" OnDelete="EnableDelete" DisableDelete="_disableDelete" ShowDelete="@Content.ShowDelete" />

    <FluentSelect Items=@_validTypes
                  Label="Contact Type:"
                  OptionText="@(i => i.Text)"
                  OptionValue="@(i => i.Value)"
                  OptionSelected="@(i => i.Selected)"
                  @bind-Value="@Content.Value.Type" />

    <FluentTextField Class="dialog-editbox" @bind-Value="@Content.Value.Value">Value:</FluentTextField>

    @if (_disableDelete)
    {
        <Ask IsAlert="true" OnYes="OnDeleteButton" OnNo="ClearDelete" Message="Do you want to delete this contact?"></Ask>
    }

</FluentDialogBody>

@code {
    [Parameter] public PanelParameters<ContactModel> Content { get; set; } = default!;
    [CascadingParameter] public FluentDialog Dialog { get; set; } = null!;

    private bool _disableDelete = false;

    static List<Fluent.Option<string>> _validTypes = new()
    {
        new Fluent.Option<string> { Value = "Email", Text = "Email" },
        new Fluent.Option<string> { Value = "Phone", Text = "Phone" },
    };

    private async Task OnSetButton() => await Dialog.CloseAsync(PanelResult<ContactModel>.Set(Content.Value));
    private async Task OnDeleteButton() => await Dialog.CloseAsync(PanelResult<ContactModel>.Delete());
    public async Task OnCloseButton() => await Dialog.CancelAsync();

    public void EnableDelete() => _disableDelete = true;
    public void ClearDelete() => _disableDelete = false;
}